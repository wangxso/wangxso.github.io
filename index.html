<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>非典型程序员的一生</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="程序员 | 工程师 | 摄影爱好者 | 骑行客">
<meta property="og:type" content="website">
<meta property="og:title" content="非典型程序员的一生">
<meta property="og:url" content="https://wangxso.github.io/blog./index.html">
<meta property="og:site_name" content="非典型程序员的一生">
<meta property="og:description" content="程序员 | 工程师 | 摄影爱好者 | 骑行客">
<meta property="og:locale">
<meta property="article:author" content="wangxso">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/blog./atom.xml" title="非典型程序员的一生" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/blog./favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/blog./css/style.css">

  
    
<link rel="stylesheet" href="/blog./fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog./" id="logo">非典型程序员的一生</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/blog./">Home</a>
        
          <a class="main-nav-link" href="/blog./archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/blog./atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Suche"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://wangxso.github.io/blog."></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-OpenCDA V2X通信相关" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog./2023/09/14/OpenCDA%20V2X%E9%80%9A%E4%BF%A1%E7%9B%B8%E5%85%B3/" class="article-date">
  <time class="dt-published" datetime="2023-09-13T22:19:49.000Z" itemprop="datePublished">2023-09-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog./categories/selfdriving/">selfdriving</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog./2023/09/14/OpenCDA%20V2X%E9%80%9A%E4%BF%A1%E7%9B%B8%E5%85%B3/">OpenCDA V2X通信相关</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="一、V2X-Manager"><a href="#一、V2X-Manager" class="headerlink" title="一、V2X Manager"></a>一、V2X Manager</h2><h3 id="init"><a href="#init" class="headerlink" title="init"></a>init</h3><ol>
<li><p>变量</p>
<ul>
<li><p>cav_world(object): OpenCDA的对象，详细可见<code>core/common/cav_world.py</code>.定制的世界对象，可以保存所有的CDA车辆信息和管理共享ML模型，在联合仿真中也可以保存Sumo-Carla的ID映射。</p>
</li>
<li><p>config_yaml(dict): v2x模块的配置信息字典变量。</p>
</li>
<li><p>vid: 相应vehicle manager的uuid。</p>
</li>
</ul>
</li>
<li><p>方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, cav_world, config_yaml, vid</span>):</span><br><span class="line">        <span class="comment"># if disabled, no cooperation will be operated</span></span><br><span class="line">        <span class="comment"># 如果是disabled，协作相关的不会被运用。</span></span><br><span class="line">        self.cda_enabled = config_yaml[<span class="string">&#x27;enabled&#x27;</span>]</span><br><span class="line">        <span class="comment"># 读取通信距离</span></span><br><span class="line">        self.communication_range = config_yaml[<span class="string">&#x27;communication_range&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># found CAVs nearby</span></span><br><span class="line">        <span class="comment"># 被发现的周边的CAVs</span></span><br><span class="line">        self.cav_nearby = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># used for cooperative perception.</span></span><br><span class="line">        <span class="comment"># 收到数据的缓存, dict</span></span><br><span class="line">        self._recieved_buffer = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># used for platooning communication</span></span><br><span class="line">        <span class="comment"># 队列通信，platooning_plugin是队列通信器件所使用的队列插件</span></span><br><span class="line">        self.platooning_plugin = PlatooningPlugin(</span><br><span class="line">            self.communication_range, self.cda_enabled)</span><br><span class="line">		<span class="comment"># weakref.ref 是 Python 中的一个内置模块，它提供了一种创建对象的弱引用的方式。</span></span><br><span class="line">        <span class="comment"># 这里的作用应该是让cav_world在不被使用的时候能够及时被回收。</span></span><br><span class="line">        self.cav_world = weakref.ref(cav_world)()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ego position buffer. use deque so we can simulate lagging</span></span><br><span class="line">        <span class="comment"># ego car的位置和速度信息缓存，使用deque可以模拟延迟。</span></span><br><span class="line">        self.ego_pos = deque(maxlen=<span class="number">100</span>)</span><br><span class="line">        self.ego_spd = deque(maxlen=<span class="number">100</span>)</span><br><span class="line">        <span class="comment"># used to exclude the cav self during searching</span></span><br><span class="line">        <span class="comment"># 用于搜索周边车辆的时候排除自身</span></span><br><span class="line">        self.vid = vid</span><br><span class="line"></span><br><span class="line">        <span class="comment"># check if lag or noise needed to be added during communication</span></span><br><span class="line">        <span class="comment"># 添加一些噪声和延迟</span></span><br><span class="line">        self.loc_noise = <span class="number">0.0</span></span><br><span class="line">        self.yaw_noise = <span class="number">0.0</span></span><br><span class="line">        self.speed_noise = <span class="number">0.0</span></span><br><span class="line">        self.lag = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Add noise to V2X communication if needed.</span></span><br><span class="line">        <span class="comment"># 如果在配置文件中配置，就添加相关的噪声</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;loc_noise&#x27;</span> <span class="keyword">in</span> config_yaml:</span><br><span class="line">            self.loc_noise = config_yaml[<span class="string">&#x27;loc_noise&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;yaw_noise&#x27;</span> <span class="keyword">in</span> config_yaml:</span><br><span class="line">            self.yaw_noise = config_yaml[<span class="string">&#x27;yaw_noise&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;speed_noise&#x27;</span> <span class="keyword">in</span> config_yaml:</span><br><span class="line">            self.speed_noise = config_yaml[<span class="string">&#x27;speed_noise&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;lag&#x27;</span> <span class="keyword">in</span> config_yaml:</span><br><span class="line">            self.lag = config_yaml[<span class="string">&#x27;lag&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>该方法是来初始化v2x_manager的，相关的逻辑在注释中已经写出。这里大概是通过本身所拥有的cav_nearby字典来保存发现的周围车辆发送的V2X信息。</p>
</li>
</ol>
<h3 id="update-info"><a href="#update-info" class="headerlink" title="update_info"></a>update_info</h3><ol>
<li>变量<ul>
<li>ego_pos: 车辆的位置信息，是carla的transform对象</li>
<li>ego_spd: 车辆的速度信息，float，km&#x2F;h</li>
</ul>
</li>
<li>方法</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">update_info</span>(<span class="params">self, ego_pos, ego_spd</span>):</span><br><span class="line">       <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">       Update all communication plugins with current localization info.</span></span><br><span class="line"><span class="string">       &quot;&quot;&quot;</span></span><br><span class="line">       <span class="comment"># 更新所有的通信插件中的当前位置信息</span></span><br><span class="line">       self.ego_pos.append(ego_pos)</span><br><span class="line">       self.ego_spd.append(ego_spd)</span><br><span class="line">       <span class="comment"># 并且同时搜索周围的车辆信息</span></span><br><span class="line">       self.search()</span><br><span class="line"></span><br><span class="line">       <span class="comment"># the ego pos in platooning_plugin is used for self-localization,</span></span><br><span class="line">       <span class="comment"># so we shouldn&#x27;t add noise or lag.</span></span><br><span class="line">       self.platooning_plugin.update_info(ego_pos, ego_spd)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>首先会在本车的<code>ego_pos</code>和<code>ego_spd</code>的队列中添加当前的位置，然后所有周围的车辆信息，同时更新所有的插件中的当前位置信息。下面我们看看<code>search()</code>中是怎么实现的。</p>
<h3 id="search"><a href="#search" class="headerlink" title="search"></a>search</h3><ol>
<li><p>变量</p>
<p>无</p>
</li>
<li><p>方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">search</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Search the CAVs nearby.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 获取当前CAV World中的车辆字典</span></span><br><span class="line">        vehicle_manager_dict = self.cav_world.get_vehicle_managers()</span><br><span class="line">		</span><br><span class="line">        <span class="comment"># 获取所有车辆的vid和vm</span></span><br><span class="line">        <span class="keyword">for</span> vid, vm <span class="keyword">in</span> vehicle_manager_dict.items():</span><br><span class="line">            <span class="comment"># avoid the Nonetype error at the first simulation step</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> vm.v2x_manager.get_ego_pos():</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="comment"># avoid add itself as the cav nearby</span></span><br><span class="line">            <span class="keyword">if</span> vid == self.vid:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="comment"># 计算车辆和当前车的距离</span></span><br><span class="line">            distance = compute_distance(</span><br><span class="line">                self.ego_pos[-<span class="number">1</span>].location,</span><br><span class="line">                vm.v2x_manager.get_ego_pos().location)</span><br><span class="line">			<span class="comment"># 如果距离在通信范围内，就将周围cav的获取的信息更新</span></span><br><span class="line">            <span class="keyword">if</span> distance &lt; self.communication_range:</span><br><span class="line">                self.cav_nearby.update(&#123;vid: vm&#125;)</span><br></pre></td></tr></table></figure>

<p>大概的过程就是先从cav world里面获取所有的车辆信息，遍历这些车辆，通过计算车辆和当前车辆的距离信息，如果距离在通信范围内的话，就会将车辆发送的信息加入到<code>cav_nearby</code>里面。</p>
</li>
</ol>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>大概的方法就这些，主要就是实现一个<code>search</code>的方法，还有一些方法没有提到比如<code>get_ego_pos</code>和<code>get_ego_speed</code>这些都是在获取位置和速度信息的时候增加一些噪声。</p>
<h2 id="二、RSUManager-鉴定为半成品"><a href="#二、RSUManager-鉴定为半成品" class="headerlink" title="二、RSUManager(鉴定为半成品)"></a>二、RSUManager(鉴定为半成品)</h2><h3 id="init-1"><a href="#init-1" class="headerlink" title="init"></a>init</h3><ol>
<li><p>变量</p>
<ul>
<li>carla_world(carla.World): Carla的world对象，我们从中获取蓝图(blueprint)</li>
<li>config_yaml(dict): 关于RSU的配置信息</li>
<li>carla_map(carla.Map):  carla里面的地图对象</li>
<li>cav_world(object): cav世界中的相关信息，包括车辆信息等</li>
<li>current_time(str): 仿真开始的时间戳，用于数据导出</li>
<li>data_dumping(bool)：在仿真期间是否导出传感器信息</li>
</ul>
</li>
<li><p>方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">            self,</span></span><br><span class="line"><span class="params">            carla_world,</span></span><br><span class="line"><span class="params">            config_yaml,</span></span><br><span class="line"><span class="params">            carla_map,</span></span><br><span class="line"><span class="params">            cav_world,</span></span><br><span class="line"><span class="params">            current_time=<span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="params">            data_dumping=<span class="literal">False</span></span>):</span><br><span class="line"></span><br><span class="line">        self.rid = config_yaml[<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">        <span class="comment"># The id of rsu is always a negative int</span></span><br><span class="line">        <span class="comment"># rsu的id永远是一个负整数，这是为了和车辆id进行区分</span></span><br><span class="line">        <span class="keyword">if</span> self.rid &gt; <span class="number">0</span>:</span><br><span class="line">            self.rid = -self.rid</span><br><span class="line"></span><br><span class="line">        <span class="comment"># read map from the world everytime is time-consuming, so we need</span></span><br><span class="line">        <span class="comment"># explicitly extract here</span></span><br><span class="line">        <span class="comment"># 每次都读取地图会很耗时，所以我们在一开始就读取，这样只用一次就好了。</span></span><br><span class="line">        self.carla_map = carla_map</span><br><span class="line"></span><br><span class="line">        <span class="comment"># retrieve the configure for different modules</span></span><br><span class="line">        <span class="comment"># 检索不同模块的配置信息</span></span><br><span class="line">        <span class="comment"># todo: add v2x module to rsu later</span></span><br><span class="line">        sensing_config = config_yaml[<span class="string">&#x27;sensing&#x27;</span>]</span><br><span class="line">        sensing_config[<span class="string">&#x27;localization&#x27;</span>][<span class="string">&#x27;global_position&#x27;</span>] = \</span><br><span class="line">            config_yaml[<span class="string">&#x27;spawn_position&#x27;</span>]</span><br><span class="line">        sensing_config[<span class="string">&#x27;perception&#x27;</span>][<span class="string">&#x27;global_position&#x27;</span>] = \</span><br><span class="line">            config_yaml[<span class="string">&#x27;spawn_position&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># localization module</span></span><br><span class="line">        <span class="comment"># 获取定位模块</span></span><br><span class="line">        self.localizer = LocalizationManager(carla_world,</span><br><span class="line">                                             sensing_config[<span class="string">&#x27;localization&#x27;</span>],</span><br><span class="line">                                             self.carla_map)</span><br><span class="line">        <span class="comment"># perception module</span></span><br><span class="line">        <span class="comment"># 获取预测模块</span></span><br><span class="line">        self.perception_manager = PerceptionManager(vehicle=<span class="literal">None</span>,</span><br><span class="line">                                                    config_yaml=sensing_config[<span class="string">&#x27;perception&#x27;</span>],</span><br><span class="line">                                                    cav_world=cav_world,</span><br><span class="line">                                                    carla_world=carla_world,</span><br><span class="line">                                                    data_dump=data_dumping,</span><br><span class="line">                                                    infra_id=self.rid)</span><br><span class="line">        <span class="comment"># 判断是否需要导出数据</span></span><br><span class="line">        <span class="keyword">if</span> data_dumping:</span><br><span class="line">            self.data_dumper = DataDumper(self.perception_manager,</span><br><span class="line">                                          self.rid,</span><br><span class="line">                                          save_time=current_time)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.data_dumper = <span class="literal">None</span></span><br><span class="line">		<span class="comment"># 更新world中的rsu信息</span></span><br><span class="line">        cav_world.update_rsu_manager(self)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="update-info（main分支未完成）"><a href="#update-info（main分支未完成）" class="headerlink" title="update_info（main分支未完成）"></a>update_info（main分支未完成）</h3><ol>
<li><p>变量</p>
<p>无</p>
</li>
<li><p>方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">update_info</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Call perception and localization module to</span></span><br><span class="line"><span class="string">        retrieve surrounding info an ego position.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># localization</span></span><br><span class="line">        self.localizer.localize()</span><br><span class="line"></span><br><span class="line">        ego_pos = self.localizer.get_ego_pos()</span><br><span class="line">        ego_spd = self.localizer.get_ego_spd()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># object detection todo: pass it to other CAVs for V2X percetion</span></span><br><span class="line">        objects = self.perception_manager.detect(ego_pos)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="run-step"><a href="#run-step" class="headerlink" title="run_step"></a>run_step</h3><ol>
<li><p>变量</p>
<p>无</p>
</li>
<li><p>方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">run_step</span>(<span class="params">self</span>):</span><br><span class="line">       <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">       Currently only used for dumping data.</span></span><br><span class="line"><span class="string">       &quot;&quot;&quot;</span></span><br><span class="line">       <span class="comment"># dump data</span></span><br><span class="line">       <span class="keyword">if</span> self.data_dumper:</span><br><span class="line">           self.data_dumper.run_step(self.perception_manager,</span><br><span class="line">                                     self.localizer,</span><br><span class="line">                                     <span class="literal">None</span>)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="destroy"><a href="#destroy" class="headerlink" title="destroy"></a>destroy</h3><ol>
<li><p>变量</p>
<p>无</p>
</li>
<li><p>方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">destroy</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Destroy the actor vehicle</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    self.perception_manager.destroy()</span><br><span class="line">    self.localizer.destroy()</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>这个RSU基本上属于半成品，或者半成品都不到，只是新建文件夹这种。反正在main分支上是这样的，其他分支我还需要后续看看。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wangxso.github.io/blog./2023/09/14/OpenCDA%20V2X%E9%80%9A%E4%BF%A1%E7%9B%B8%E5%85%B3/" data-id="clmivdq82000psjp60ulc3v7l" data-title="OpenCDA V2X通信相关" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog./tags/OpenCDA/" rel="tag">OpenCDA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog./tags/V2X/" rel="tag">V2X</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-古朴韵味与荒野之美 ------- 西安、青海之旅" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog./2023/08/28/%E5%8F%A4%E6%9C%B4%E9%9F%B5%E5%91%B3%E4%B8%8E%E8%8D%92%E9%87%8E%E4%B9%8B%E7%BE%8E%20-------%20%E8%A5%BF%E5%AE%89%E3%80%81%E9%9D%92%E6%B5%B7%E4%B9%8B%E6%97%85/" class="article-date">
  <time class="dt-published" datetime="2023-08-28T06:40:00.000Z" itemprop="datePublished">2023-08-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog./categories/youji/">youji</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog./2023/08/28/%E5%8F%A4%E6%9C%B4%E9%9F%B5%E5%91%B3%E4%B8%8E%E8%8D%92%E9%87%8E%E4%B9%8B%E7%BE%8E%20-------%20%E8%A5%BF%E5%AE%89%E3%80%81%E9%9D%92%E6%B5%B7%E4%B9%8B%E6%97%85/">古朴韵味与荒野之美 ------- 西安、青海之旅</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><em><strong>Sony A7R2, TAMRON 28-200mm F2.8-5.6 Di III RXD</strong></em></p>
<hr>
<p>三年疫情过去，说长不长，说短也不短。三年里从本科到硕士毕业，感觉对于学习的能力在下降，我更想去探索生活和记录生活。这次旅行是在写完毕业论文提交盲审后的一段安排。对于南方人说，北方或者说西北有一种朦胧的神秘，在我人生短短的二十多年中，到达过最北的大抵就是武汉了。这是我初次出去旅行和拍摄，对于拍摄我可能说是一个只会操纵相机的猴子。首先我们选择在西安中转，无他耳，只是因为飞西安便宜。西安给我留下了深刻的印象，美丽的古城映照着红墙的寺庙。可惜的是由于行程问题有许多遗憾留下。</p>
<h2 id="西安"><a href="#西安" class="headerlink" title="西安"></a>西安</h2><p>第一站，我跟随胡雪松的表妹来到了他所在的西北大学。西北大学这个校区校园虽然不大但是包含了西安所独有的古朴的气息。<br>来到西北大礼堂，也就是传说中的小白楼，了解了其中一段有趣的历史渊源。<br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/3813356871.png" alt="西北大礼堂"><br>走过西北大学的校园道路，我们看到脚下历史悠久的井盖。据说这样的井盖有上百个，并且有着不同的年份，西北大学的学生甚至以此做过研究发表论文。<br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/2938987182.png" alt="西北大学1954年井盖"><br>最后我们来到了西北大学博物馆，可惜来的不是时候，博物馆闭馆了。<br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/1476217277.jpg" alt="西北大学博物馆"></p>
<p>走出西北大学我们就和表妹告别了，准备向着古城墙出发，由于我们属于不太认识路的那种，在城墙边上寻找上去的道路，寻找了很久，沿途路过一处花团锦簇的饭店门口，有着春天的气息。<br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/1545597816.jpg" alt="DSC05932.jpg"></p>
<p>下面我们走过一段隧道就正式来到了，古城墙的入口。<br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/971842628.jpg" alt="地下通道"></p>
<p>走到城墙上方，一眼过去，人头攒动，虽然这天气真的很热。<br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/886221511.jpg" alt="西安古城墙"><br>远远地望去，嘿嘿，我也忘了这个地方叫啥了。<br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/1372622295.jpg" alt="城墙远眺"><br>缓缓的(快热死了)我们走到了终点，一个烽火台？下面。<br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/4060244418.jpg" alt="高瓴"><br>逛饿了，我们就开始吃饭吧！<br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/2512007600.jpg" alt="image (1).jpg"><br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/277929408.jpg" alt="image (5).jpg"><br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/3714476498.jpg" alt="image (6).jpg"><br>一天下来真的很累，所以我们决定会酒店休息咯。在回酒店的路上顺便看了一下<strong>大慈恩寺</strong>。<br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/2073555675.jpg" alt="image (4).jpg"><br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/4234501894.jpg" alt="image (3).jpg"><br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/957516762.jpg" alt="image (2).jpg"></p>
<h2 id="青海"><a href="#青海" class="headerlink" title="青海"></a>青海</h2><p>关于青海，我们首先到达的事西宁，一来到西宁我们就前往了酒店。第一天定的一个舒适性还不错，然后晚上我们决定出去觅食。这段旅行只能说不是很顺利，一开始我们跟随司机来到了青海湖，青海湖真的很美，但是我们不能很近的一亲芳泽。到了二郎剑景区，虽然说不要钱，但是这里的景色真的很一般。然后我们便驱车前往了下一个橡皮山，这里就是一个很烂的山坡，没啥好讲的。后面我们前往了茶卡盐湖，我们去的时候是四月下旬，反正盐湖没啥水，感觉不值得。第二天，我们继续绕着青海湖走，前往横断山脉那边的有着小瑞士之称的卓尔山，好巧不巧来了沙尘暴，上山后啥也看不着。然后回到西宁我们去了塔尔寺。最后青海小环线之旅就此结束了。</p>
<p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/1791517377.jpg" alt="DSC06069 (1).jpg"><br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/795593279.jpg" alt="DSC06047.jpg"><br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/288589143.jpg" alt="314d6203d4bec7beda70eb053305fbc.jpg"><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/2596442127.jpg" alt="25ea9e2c74fadab79a4dd661d52c9b2.jpg"><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/598076735.jpg" alt="efba6f1018e088ce249f752fbfbe0b0.jpg"><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/3859517670.jpg" alt="f695b216443d722aff526bca2f40518.jpg"><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/2685070725.jpg" alt="326dad42a44eb1323af943669a2ace1.jpg"><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/1745825100.jpg" alt="a40a73f7a43f1222d0c582d3c92f256.jpg"><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/1981706962.jpg" alt="a4e2d0a86334f271f6716f85617eb37 (1).jpg"><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/4156691668.jpg" alt="DSC06230 (1).jpg"><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/4051008838.jpg" alt="DSC06124.jpg"><br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/4063973357.jpg" alt="WechatIMG31 (1).jpg"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wangxso.github.io/blog./2023/08/28/%E5%8F%A4%E6%9C%B4%E9%9F%B5%E5%91%B3%E4%B8%8E%E8%8D%92%E9%87%8E%E4%B9%8B%E7%BE%8E%20-------%20%E8%A5%BF%E5%AE%89%E3%80%81%E9%9D%92%E6%B5%B7%E4%B9%8B%E6%97%85/" data-id="clmivdq8s0050sjp653gp6wpq" data-title="古朴韵味与荒野之美 ------- 西安、青海之旅" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog./tags/%E6%91%84%E5%BD%B1/" rel="tag">摄影</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-【OpenCDA】算法定制化开发" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog./2023/08/03/%E3%80%90OpenCDA%E3%80%91%E7%AE%97%E6%B3%95%E5%AE%9A%E5%88%B6%E5%8C%96%E5%BC%80%E5%8F%91/" class="article-date">
  <time class="dt-published" datetime="2023-08-02T23:08:00.000Z" itemprop="datePublished">2023-08-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog./categories/selfdriving/">selfdriving</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog./2023/08/03/%E3%80%90OpenCDA%E3%80%91%E7%AE%97%E6%B3%95%E5%AE%9A%E5%88%B6%E5%8C%96%E5%BC%80%E5%8F%91/">【OpenCDA】算法定制化开发</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="定制化"><a href="#定制化" class="headerlink" title="定制化"></a>定制化</h1><p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/120818750.png"><br>由于OpenCDA的高度模块化，您可以方便地用自己的算法替换任何默认模块。定制的方法是将您定制的模块放在<code>opencda/customize/...</code>里面，并且使用继承来覆盖原有算法。然后在<code>VehicleManager</code>中导入你定制的算法即可。如果你想要修改单个模块你所需要做的事情就是保证修改后的模块和原有的模块的输入输出格式保持一致。此外，对于Control算法模块的修改并不是在<code>opencda/customize/...</code> 里面，而是在原来的<code>opencda/core/acutation/</code></p>
<p>下面介绍各个模块都是如何进行算法的定制化开发的。</p>
<h2 id="Localization-Customization"><a href="#Localization-Customization" class="headerlink" title="Localization Customization"></a><strong><strong>Localization Customization</strong></strong></h2><p><code>LocalizationManager</code> 负责定位任务。在初始化阶段，将生成的GPS和IMU传感器来收集定位相关的信息。</p>
<p>里面的核心功能是<code>localize()</code> ，这个方法没有任何的输入，他主要的作用是为了<code>self._ego_pos</code> 和<code>_speed</code> 提供正确的值。</p>
<p>融合 GPS 和 IMU 数据的默认算法是卡尔曼滤波器(Kalman Filter)，它以当前的gps和imu数据为输入，然后返回修正后的$(x, y, z)$坐标。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># opencda/core/sensing/localization/localization_manager.py:line 142</span></span><br><span class="line"><span class="keyword">from</span> opencda.core.sensing.localization.kalman_filter <span class="keyword">import</span> KalmanFilter</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LocalizationManager</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">     <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, vehicle, config_yaml, carla_map</span>):</span><br><span class="line">        self.kf = KalmanFilter(self.dt)</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">def</span> <span class="title function_">localize</span>(<span class="params">self</span>):</span><br><span class="line">        ...</span><br><span class="line">        corrected_cords = self.kf(x, y, z, speed, yaw, imu_yaw_rate)</span><br></pre></td></tr></table></figure>

<p>如果用户想要保留定位的整个结构而只更换滤波器（例如扩展卡尔曼滤波器），然后他只需要创建一个在  <code>opencda/customize/core/sensing/localization</code>目录下创建一个 <code>localization_manager.py</code> 。并且在<code>CustomizedLocalizationManager</code> 中初始化的时候加入拓展卡尔曼滤波器。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># opencda/customize/core/sensing/localization/localization_manager.py:line 0</span></span><br><span class="line"><span class="keyword">from</span> opencda.core.sensing.localization.localization_manager <span class="keyword">import</span> LocalizationManager</span><br><span class="line"><span class="keyword">from</span> opencda.customize.core.sensing.localization.extented_kalman_filter <span class="keyword">import</span> ExtentedKalmanFilter</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomizedLocalizationManager</span>(<span class="title class_ inherited__">LocalizationManager</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, vehicle, config_yaml, carla_map</span>):</span><br><span class="line">        <span class="built_in">super</span>(CustomizedLocalizationManager, self).__init__(vehicle, config_yaml, carla_map)</span><br><span class="line">        self.kf = ExtentedKalmanFilter(self.dt)         </span><br></pre></td></tr></table></figure>

<p>然后去<code>VehicleManger</code> 类里面导入自定义模块并且设置其启用:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> opencda.core.sensing.localization.localization_manager <span class="keyword">import</span> LocalizationManager</span><br><span class="line"><span class="keyword">from</span> opencda.customize.core.sensing.localization.localization_manager <span class="keyword">import</span> CustomizedLocalizationManager</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VehicleManager</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, vehicle, config_yaml, application, carla_map, cav_world</span>):</span><br><span class="line">        <span class="comment"># self.localizer = LocalizationManager(vehicle, sensing_config[&#x27;localization&#x27;], carla_map)</span></span><br><span class="line">        self.localizer = CustomizedLocalizationManager(vehicle, sensing_config[<span class="string">&#x27;localization&#x27;</span>], carla_map)</span><br></pre></td></tr></table></figure>

<p>如果您想修改的更多，比如改变数据预处理等。只需要在</p>
<p><code>CustomizedLocalizationManager</code> 中填充<code>localize()</code> 中的<code>self._ego_gps</code> 和<code>self._speed</code> 不会对下游模块造成任何问题。</p>
<h2 id="Perception-Customization"><a href="#Perception-Customization" class="headerlink" title="Perception Customization"></a><strong><strong>Perception Customization</strong></strong></h2><p><code>PerceptionManager</code> 负责感知相关的任务。现在它支持车辆检测和交通信号灯检测。核心方法<code>detect(ego_pos)</code> 将定位模块的ego_car的自我位置作为输入，返回值是一个<code>objects</code> 字典，这个字典的key是对象的类别，值是该类别中世界坐标系下每个对象的属性(比如三维姿态等)。</p>
<p>要定义您自己的目标检测算法，请在<code>opencda/customize/core/sensing/perception/</code> 文件夹下面创建一个<code>perception_manager.py</code> 文件。这里的核心就是你的<code>your_algorithm(rgb_images, lidar_data)</code> 他的输入是获取的图像信息和激光雷达点云信息。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">from</span> opencda.core.sensing.perception.perception_manager <span class="keyword">import</span> PerceptionManager</span><br><span class="line"><span class="keyword">from</span> opencda.core.sensing.perception.obstacle_vehicle <span class="keyword">import</span> ObstacleVehicle</span><br><span class="line"><span class="keyword">from</span> opencda.core.sensing.perception.static_obstacle <span class="keyword">import</span> TrafficLight</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomziedPeceptionManager</span>(<span class="title class_ inherited__">PerceptionManager</span>):</span><br><span class="line">     <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, vehicle, config_yaml, cav_world, data_dump=<span class="literal">False</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(CustomizedLocalizationManager, self).__init__(vehicle, config_yaml, cav_world, data_dump)</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">def</span> <span class="title function_">detect</span>(<span class="params">self, ego_pos</span>):</span><br><span class="line">        objects = &#123;<span class="string">&#x27;vehicles&#x27;</span>: [],</span><br><span class="line">                   <span class="string">&#x27;traffic_lights&#x27;</span>: [],</span><br><span class="line">                   <span class="string">&#x27;other_objects_you_wanna_add&#x27;</span> : []&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># retrieve current rgb images from all cameras</span></span><br><span class="line">        rgb_images = []</span><br><span class="line">        <span class="keyword">for</span> rgb_camera <span class="keyword">in</span> self.rgb_camera:</span><br><span class="line">            <span class="keyword">while</span> rgb_camera.image <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            rgb_images.append(cv2.cvtColor(np.array(rgb_camera.image),</span><br><span class="line">                    cv2.COLOR_BGR2RGB))</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># retrieve lidar data from the sensor</span></span><br><span class="line">        lidar_data = self.lidar.data</span><br><span class="line">        </span><br><span class="line">        <span class="comment">########################################</span></span><br><span class="line">        <span class="comment"># this is where you put your algorithm #</span></span><br><span class="line">        <span class="comment">########################################</span></span><br><span class="line">        objects = your_algorithm(rgb_images, lidar_data)</span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">type</span>(objects[<span class="string">&#x27;vehicles&#x27;</span>]) == ObstacleVehicle</span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">type</span>(objects[<span class="string">&#x27;traffic_lights&#x27;</span>]) == TrafficLight</span><br><span class="line">         </span><br><span class="line">     <span class="keyword">return</span> objects</span><br></pre></td></tr></table></figure>

<h2 id="Behavior-Planning-Customization"><a href="#Behavior-Planning-Customization" class="headerlink" title="Behavior Planning Customization"></a><strong><strong>Behavior Planning Customization</strong></strong></h2><p>在仿真运行期间，<code>BehaviorAgent</code> 首先会通过函数<code>update_information</code>保存从<code>PerceptionManager</code> 和<code>LocalizationManager</code> 中获得的ego vehicle的位置、速度和周围物体信息。之后<code>BehaviorAgent</code> 将会调用函数<code>run_step()</code> 执行单步，并返回<code>target_speed</code> 和<code>target_location</code> 信息。</p>
<p>您要定义自己的行为规划算法。请在<code>opencda/customize/core/plan/</code> 文件夹下创建<code>behavior_agent.py</code>文件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> carla.libcarla</span><br><span class="line"><span class="keyword">from</span> opencda.core.plan.behavior_agent <span class="keyword">import</span> BehaviorAgent</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomizedBehaviorAgent</span>(<span class="title class_ inherited__">BehaviorAgent</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, vehicle, carla_map, config_yaml</span>):</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_information</span>(<span class="params">self, ego_pos, ego_speed, objects</span>):</span><br><span class="line">        <span class="comment">########################################</span></span><br><span class="line">        <span class="comment"># this is where you put your algorithm #</span></span><br><span class="line">        <span class="comment">########################################</span></span><br><span class="line">        do_some_preprocessing(ego_pos, ego_speed, objects)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run_step</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment">########################################</span></span><br><span class="line">        <span class="comment"># this is where you put your algorithm #</span></span><br><span class="line">        <span class="comment">########################################</span></span><br><span class="line">        target_speed, target_loc = your_plan_algorithm()</span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">type</span>(target_speed) == <span class="built_in">float</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">type</span>(target_loc) == carla.Location</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> target_speed, target_loc</span><br></pre></td></tr></table></figure>

<h2 id="Control-Customization"><a href="#Control-Customization" class="headerlink" title="Control Customization"></a><strong><strong>Control Customization</strong></strong></h2><p>和<code>BehaviorAgent, ControlManger</code>类似，首先通过<code>update_info()</code> 函数保存ego vehicle的位置信息，然后通过<code>run_step()</code> 获取<code>BehaviorAgent</code>生成的<code>target_speed</code> 和<code>target_loc</code> 信息，生成最终的指令。</p>
<p>与其他模块不同，ControlManager更像是一个抽象类，它提供了调用相应控制器（默认pid控制器）的接口。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ControlManager</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, control_config</span>):</span><br><span class="line">        controller_type = control_config[<span class="string">&#x27;type&#x27;</span>]</span><br><span class="line">        controller = <span class="built_in">getattr</span>(</span><br><span class="line">            importlib.import_module(</span><br><span class="line">                <span class="string">&quot;opencda.core.actuation.%s&quot;</span> %</span><br><span class="line">                controller_type), <span class="string">&#x27;Controller&#x27;</span>)</span><br><span class="line">        self.controller = controller(control_config[<span class="string">&#x27;args&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_info</span>(<span class="params">self, ego_pos, ego_speed</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Update ego vehicle information for controller.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.controller.update_info(ego_pos, ego_speed)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run_step</span>(<span class="params">self, target_speed, target_loc</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Execute current controller step.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        control_command = self.controller.run_step(target_speed, waypoint)</span><br><span class="line">        <span class="keyword">return</span> control_command</span><br></pre></td></tr></table></figure>

<p>因此，如果你想使用 pid 控制器以外的控制器，你可以在 <code>opencda/core/acutation/</code>文件夹下创建<code>customize_controller.py</code>，并遵循相同的输入和输出数据格式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CustomizeController</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_info</span>(<span class="params">self, ego_pos, ego_spd</span>):</span><br><span class="line">        <span class="comment">########################################</span></span><br><span class="line">        <span class="comment"># this is where you put your algorithm #</span></span><br><span class="line">        <span class="comment">########################################</span></span><br><span class="line">        do_some_process(ego_pos, ego_spd)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run_step</span>(<span class="params">self, target_speed, target_loc</span>):</span><br><span class="line">        <span class="comment">########################################</span></span><br><span class="line">        <span class="comment"># this is where you put your algorithm #</span></span><br><span class="line">        <span class="comment">########################################</span></span><br><span class="line">        control_command = control(target_speed, target_loc)</span><br><span class="line">        <span class="keyword">assert</span> control_command == carla.libcarla.VehicleControl</span><br><span class="line">        <span class="keyword">return</span> control_command</span><br></pre></td></tr></table></figure>

<p>然后将控制器的名称放入 yaml 文件中：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">vehicle_base:</span></span><br><span class="line">    <span class="attr">controller:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">customize_controller</span> <span class="comment"># this has to be exactly the same name as the controller py file</span></span><br><span class="line">        <span class="attr">args:</span> <span class="string">......</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://wangxso.github.io/blog./2023/08/03/%E3%80%90OpenCDA%E3%80%91%E7%AE%97%E6%B3%95%E5%AE%9A%E5%88%B6%E5%8C%96%E5%BC%80%E5%8F%91/" data-id="clmivdq8l003msjp617ys5eoi" data-title="【OpenCDA】算法定制化开发" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-zlib 404" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog./2023/08/01/zlib%20404/" class="article-date">
  <time class="dt-published" datetime="2023-08-01T00:45:31.000Z" itemprop="datePublished">2023-08-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog./categories/zczb/">zczb</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog./2023/08/01/zlib%20404/">zlib 404</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/apollo/.cache/bazel/540135163923dd7d5820f3ee4b306b32/external/rules_proto/proto/private/dependencies.bzl</span><br></pre></td></tr></table></figure>

<p>查看输出，发现所需文件“zlib-1.2.11.tar.gz” 的预期的哈希值与实际的哈希值不匹配，这可能表示下载的文件与预期的文件不同或文件可能已被篡改。</p>
<p>新的下载链接<br><a target="_blank" rel="noopener" href="https://zlib.net/fossils/zlib-1.2.11.tar.gz">https://zlib.net/fossils/zlib-1.2.11.tar.gz</a></p>
<p>&#x2F;apollo&#x2F;.cache&#x2F;bazel&#x2F;540135163923dd7d5820f3ee4b306b32&#x2F;external&#x2F;rules_proto&#x2F;proto&#x2F;private</p>
<p>目录下面的<br>dependencies.bzl</p>
<p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/08/4096377460.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wangxso.github.io/blog./2023/08/01/zlib%20404/" data-id="clmivdq86001esjp646aa4j3b" data-title="zlib 404" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-V2X场景发展和仿真" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog./2023/07/19/V2X%E5%9C%BA%E6%99%AF%E5%8F%91%E5%B1%95%E5%92%8C%E4%BB%BF%E7%9C%9F/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T00:09:00.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog./categories/selfdriving/">selfdriving</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog./2023/07/19/V2X%E5%9C%BA%E6%99%AF%E5%8F%91%E5%B1%95%E5%92%8C%E4%BB%BF%E7%9C%9F/">V2X场景发展和仿真</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="V2X调研"><a href="#V2X调研" class="headerlink" title="V2X调研"></a>V2X调研</h1><h1 id="一、Use-Case"><a href="#一、Use-Case" class="headerlink" title="一、Use Case"></a>一、Use Case</h1><h2 id="1-用例分类"><a href="#1-用例分类" class="headerlink" title="1. 用例分类"></a>1. 用例分类</h2><p>国汽车工程学会团体标准《协同智能交通系统；车辆通讯；应用层规范和数据交换标准”（T&#x2F;CSAE 53-2017），定义了基于车路协同应用功能的17个典型应用场景，分为安全类、效率类和信息服务类，并发布了第二版第二阶段标准（T&#x2F;CSAE 53-2020）在此基础上，针对安全、效率、信息服务、交通管理、先进智能驾驶等领域新增12个典型应用场景。欧洲电信标准化协会（ETSI）定义了52个车路协同应用场景，涵盖道路安全、交通效率等方面。第三代合作伙伴计划（3GPP）定义了27个基于LTE-V2X的应用场景（3GPP TR22.885）和25个基于5G-V2X的应用场景（3GPP TR22.886）</p>
<p>Day1和Day2是指V2X（Vehicle-to-Everything）技术的应用场景分类。</p>
<p><strong>Day 1 Use Cases</strong>是指V2X技术的最初应用场景，主要是车辆安全和交通管理。这些应用场景包括：</p>
<ul>
<li><p>前方障碍物预警</p>
</li>
<li><p>侧后方碰撞预警</p>
</li>
<li><p>交叉口危险提示</p>
</li>
<li><p>交通信号优化</p>
</li>
<li><p>交通流量管理</p>
</li>
<li><p>车道交替提示<br><strong><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/07/2573423467.png"></strong><br><strong>Day 2 Use Cases</strong>是指V2X技术更加成熟后的应用场景，主要是车辆自主驾驶和智能交通管理。这些应用场景包括：</p>
</li>
<li><p>自动泊车</p>
</li>
<li><p>自动跟车</p>
</li>
<li><p>自动超车</p>
</li>
<li><p>智能路况预测</p>
</li>
<li><p>智能车辆调度</p>
</li>
<li><p>智能交通调度</p>
</li>
</ul>
<p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/07/285280660.png"></p>
<h2 id="2-Day-1-和-Day-2-以外的场景"><a href="#2-Day-1-和-Day-2-以外的场景" class="headerlink" title="2.Day 1 和 Day 2 以外的场景"></a><a target="_blank" rel="noopener" href="http://2.day/">2.Day</a> 1 和 Day 2 以外的场景</h2><h3 id="1-高速公路车道线协调-day2"><a href="#1-高速公路车道线协调-day2" class="headerlink" title="(1) 高速公路车道线协调(day2?)"></a>(1) 高速公路车道线协调(day2?)</h3><p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/07/834551859.png"></p>
<p>V2P的场景</p>
<p>V2P通过手机、智能穿戴设备（智能手表等）等实现车与行人信号交互，在根据车与人之间速度、位置等信号判断有一定的碰撞隐患时，车辆通过仪表及蜂鸣器，手机通过图像及声音提示注意前方车辆或行人。</p>
<p><strong>1）道路行人预警</strong></p>
<p>行人穿越道路时，道路行驶车辆与人进行信号交互，当检测到具有碰撞隐患时，车辆会收到图片和声音提示驾驶员，同样行人收到手机屏幕图像或声音提示，这项技术非常实用，因为目前手机“低头党”非常多，过马路时经常有人只顾盯着手机屏幕，无暇顾及周边环境。</p>
<p><strong>2）倒车预警</strong></p>
<p>行人经过正在经过倒车出库的汽车时，由于驾驶员视觉盲区未能及时发现周边的人群（尤其是玩耍的儿童），很容易发生交通事故，这与借助全景影像进行泊车功能类似。</p>
<h3 id="2-远程驾驶"><a href="#2-远程驾驶" class="headerlink" title="(2) 远程驾驶"></a>(2) 远程驾驶</h3><p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/07/3218185360.png"></p>
<p>用户或者云计算服务器通过V2N的网络控制车辆自动驾驶。</p>
<h3 id="3-通过V2X优先紧急车辆的智能交通灯控制"><a href="#3-通过V2X优先紧急车辆的智能交通灯控制" class="headerlink" title="(3) 通过V2X优先紧急车辆的智能交通灯控制"></a>(3) 通过V2X优先紧急车辆的智能交通灯控制</h3><p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/07/143835845.png"></p>
<p>当交通灯系统被黑客攻击时,论文提出的应对措施主要包括:</p>
<ol>
<li>使用VANET网络使车辆之间进行实时通讯和信息共享,形成去中心化的交通管理,不完全依赖易受攻击的中心化交通控制系统。</li>
<li>利用车载传感器和摄像头等设备检测交通状态,点对点地协调交通,降低对交通信号灯的依赖。</li>
<li>紧急车辆(如救护车)通过车对车(V2V)通信广播优先级消息,要求其他车辆让行。其他车辆接收到后,自动让行或跟随紧急车辆通过。</li>
<li>通过车载GPS和数字地图, Calculates 最优路径供紧急车辆导航,无需依赖交通信号指令。</li>
<li>利用边缘计算服务器协助车辆运算和协调,减轻对车载计算能力的依赖。</li>
<li>警察和政府部门利用管理平台对交通状态进行监控和协调,发布交通指令控制特定地点的车流。</li>
<li>在发生攻击时,向司机发出警告,要求人工驾驶待交通系统恢复。</li>
</ol>
<h3 id="4-智能安防"><a href="#4-智能安防" class="headerlink" title="(4) 智能安防"></a>(4) 智能安防</h3><p>智能安防则是目前汽车领域的一个热点，通过V2X<a target="_blank" rel="noopener" href="https://www.qxwz.com/solutions/autovehicle">车路协同</a>系统可以实现车辆和周围环境的实时监控和预警，提高车辆的安全性和防盗性。</p>
<h1 id="二、相关仿真"><a href="#二、相关仿真" class="headerlink" title="二、相关仿真"></a>二、相关仿真</h1><h3 id="⭐️‣"><a href="#⭐️‣" class="headerlink" title="⭐️‣"></a>⭐️‣</h3><p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/07/999851822.png"></p>
<p><strong>仿真工具</strong></p>
<p>仿真工具中的功能模块具备以下特点：</p>
<ol>
<li>基础功能完善。该平台由Sumo与Carla联合搭建，包含了完善自动驾驶功能模块，如3D环境模块、交通流模块、传感器模块等。</li>
<li>可拓展性强。用户可以依据自己的需求来使用OpenCDA平台。比如只是单纯了解交通性能，在Sumo上就可以完成；但假如在多车协同自动驾驶的基础上还要进一步了解通信模型，那么继续集成ns-3等工具也是可以的。</li>
</ol>
<p><strong><strong>合作驾驶系统</strong></strong></p>
<p>合作驾驶系统中的算法具备以下特点：</p>
<ol>
<li>基础算法完善。OpenCDA平台包含了自动驾驶大脑的感知、规划、控制等算法。</li>
<li>多车协同算法集成。OpenCDA平台额外添加了一个应用层，主要用于实施多辆自动驾驶车的协同行为。具体算法包括多车协同感知、协同定位、车辆编队等。</li>
<li>模块化。上述所有模块都附带默认算法或协议，用户只需要一行代码即可在不影响其他部分的情况下，用自定义的算法或协议来替换默认设置。从而比较和评估算法性能。</li>
</ol>
<p><strong><strong>场景管理器</strong></strong></p>
<p>场景管理具备以下模块：</p>
<ol>
<li>场景配置文件。OpenCDA在该部分中分为两个软件的场景定义。Carla中静态元素由xdor文件定义，Sumo中动态元素由yaml文件定义。</li>
<li>场景初始化器。加载上述场景文件后，可以构建仿真环境、指导动态交通行为。</li>
<li>评估函数。当仿真结束后，OpenCDA会分别从Carla的驾驶层级与Sumo的交通层级来分别做出评价。</li>
</ol>
<p><strong>运行逻辑</strong></p>
<p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/07/1836118110.png"></p>
<ol>
<li>用户需要根据 OpenCDA 提供的模板创建 yaml 文件来配置 CARLA 服务器的设置（例如同步模式与异步模式）、流量规格（例如数量）人类驾驶车辆的数量、生成位置）以及每个联网自动车辆的参数（例如，传感器参数、检测模型选择、目标速度）</li>
<li>构建场景（仅限CARLA）。如果模拟只需要CARLA模拟器，那么给出yaml文件后，场景管理器将加载该文件并通过opencda.sim_api构建场景。用户需要首先将yaml文件加载到字典中，并初始化ScenarioManager。</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> opencda.scenario_testing.utils.sim_api <span class="keyword">as</span> sim_api</span><br><span class="line"></span><br><span class="line"><span class="comment"># Aad yaml file into a dictionary</span></span><br><span class="line">scenario_params = load_yaml(config_yaml)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create CAV world object to store all CAV VehicleManager info.</span></span><br><span class="line"><span class="comment"># this is the key element to achieve cooperation</span></span><br><span class="line">cav_world = CavWorld(opt.apply_ml)</span><br><span class="line"></span><br><span class="line"><span class="comment"># create scenario manager</span></span><br><span class="line">scenario_manager = sim_api.ScenarioManager(scenario_params,</span><br><span class="line">                                           opt.apply_ml,</span><br><span class="line">                                           town=<span class="string">&#x27;Town06&#x27;</span>,</span><br><span class="line">                                           cav_world=cav_world</span><br></pre></td></tr></table></figure>

<p>之后，将生成排和单个 CAV。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create a list of platoon</span></span><br><span class="line">platoon_list = scenario_manager.create_platoon_manager(</span><br><span class="line">        map_helper=map_api.spawn_helper_2lanefree,</span><br><span class="line">        data_dump=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># create a list of single CAV</span></span><br><span class="line">single_cav_list = scenario_manager.create_vehicle_manager(application=[<span class="string">&#x27;single&#x27;</span>])</span><br></pre></td></tr></table></figure>

<p>接下来，产生交通流。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create background traffic under Carla</span></span><br><span class="line">traffic_manager, bg_veh_list = scenario_manager.create_traffic_carla()</span><br></pre></td></tr></table></figure>

<p>最后，创建EvaluationManager</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> opencda.scenario_testing.evaluations.evaluate_manager <span class="keyword">import</span> EvaluationManager</span><br><span class="line">eval_manager = \</span><br><span class="line">    EvaluationManager(scenario_manager.cav_world,</span><br><span class="line">                      script_name=<span class="string">&#x27;platoon_joining_town06_carla&#x27;</span>,</span><br><span class="line">                      current_time=scenario_params[<span class="string">&#x27;current_time&#x27;</span>])</span><br></pre></td></tr></table></figure>

<ol>
<li>构建场景（联合仿真）在联合仿真设置下构建场景与仅在 CARLA 中构建场景非常相似。只有两个区别：1）联合仿真需要额外的 Sumo 文件。 2）不使用ScenarioManager，而是使用CoScenarioManager来控制流量。</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> opencda.scenario_testing.utils.cosim_api <span class="keyword">as</span> sim_api</span><br><span class="line"></span><br><span class="line"><span class="comment"># there should be a Town06.sumocfg, a Town06.net.xml, and a Town06.rou.xml in</span></span><br><span class="line"><span class="comment"># Town06 folder</span></span><br><span class="line">sumo_cfg = <span class="string">&#x27;Town06&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># create co-simulation scenario manager</span></span><br><span class="line">scenario_manager = \</span><br><span class="line">    sim_api.CoScenarioManager(scenario_params,</span><br><span class="line">                              opt.apply_ml,</span><br><span class="line">                               town=<span class="string">&#x27;Town06&#x27;</span>,</span><br><span class="line">                              cav_world=cav_world,</span><br><span class="line">                              sumo_file_parent_path=sumo_cfg)</span><br></pre></td></tr></table></figure>

<ol>
<li>单步运行</li>
<li>保持模拟循环运行</li>
<li>评估</li>
</ol>
<h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><p><strong>合作驾驶测试</strong></p>
<ol>
<li>合并进入队伍</li>
</ol>
<p><img src="https://opencda-documentation.readthedocs.io/en/latest/_images/platoon_joining_2lanefree.gif" alt="https://opencda-documentation.readthedocs.io/en/latest/_images/platoon_joining_2lanefree.gif"></p>
<ol>
<li>合并进入队伍与SUMO联合仿真</li>
</ol>
<p><img src="https://opencda-documentation.readthedocs.io/en/latest/_images/platoon_joining_cosim.gif" alt="https://opencda-documentation.readthedocs.io/en/latest/_images/platoon_joining_cosim.gif"></p>
<ol>
<li>合并后入列</li>
</ol>
<p><img src="https://opencda-documentation.readthedocs.io/en/latest/_images/platoon_joining_town06.gif" alt="https://opencda-documentation.readthedocs.io/en/latest/_images/platoon_joining_town06.gif"></p>
<h3 id="https-github-com-ai4ce-V2X-Sim"><a href="#https-github-com-ai4ce-V2X-Sim" class="headerlink" title="https://github.com/ai4ce/V2X-Sim"></a><a target="_blank" rel="noopener" href="https://github.com/ai4ce/V2X-Sim">https://github.com/ai4ce/V2X-Sim</a></h3><p>一个智能驾驶协作感知数据集。采用SUMO生成真实的数字交通流，采用CARLA从多辆车和路边单元检索数据流。</p>
<p>V2X-Sim是vehicle-to-everythingsimulation的缩写，是纽约大学AI4CE实验室和上海交通大学MediaBrain团队开发的第一个合成的V2X辅助自动驾驶协作感知数据集，旨在促进多智能体多模态多任务感知研究 。 由于 V2X 的不成熟以及同时运行多辆自动驾驶汽车的成本，为研究社区构建这样一个真实世界的数据集非常昂贵且费力。 因此，我们使用高度真实的 CARLA-SUMO 联合仿真来确保我们的数据集与真实驾驶场景相比的代表性。</p>
<p>V2X-Sim 提供：(1) 来自路边单元 (RSU) 和多辆车辆的良好同步传感器记录，支持多智能体感知；(2) 多模态传感器流，促进多模态感知；(3) 各种经过良好注释的基本事实，支持各种感知任务，包括检测、跟踪和分割。 同时，我们构建了一个开源测试平台，并为检测、跟踪和分割等三个任务上最先进的协作感知算法提供了基准。</p>
<h3 id="https-github-com-hangqiu-AutoCastSim"><a href="#https-github-com-hangqiu-AutoCastSim" class="headerlink" title="https://github.com/hangqiu/AutoCastSim"></a><a target="_blank" rel="noopener" href="https://github.com/hangqiu/AutoCastSim">https://github.com/hangqiu/AutoCastSim</a></h3><p>AutoCastSim 是一个端到端的协同感知和协同驾驶仿真框架。它建立在 CARLA 模拟器之上，使用车辆-车辆(V2V)通信，以实现传感器共享和车辆协作。AutoCastSim 的一个特性是，它包含针对长尾事件的设计场景，在这些事件中，基于单一车辆的解决方案无法始终如一地做出安全决策。</p>
<p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/07/600110548.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wangxso.github.io/blog./2023/07/19/V2X%E5%9C%BA%E6%99%AF%E5%8F%91%E5%B1%95%E5%92%8C%E4%BB%BF%E7%9C%9F/" data-id="clmivdq850013sjp665ncgnqo" data-title="V2X场景发展和仿真" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-K8S的GPU调度" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog./2023/07/12/K8S%E7%9A%84GPU%E8%B0%83%E5%BA%A6/" class="article-date">
  <time class="dt-published" datetime="2023-07-11T23:08:25.000Z" itemprop="datePublished">2023-07-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog./categories/bxjs/">bxjs</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog./2023/07/12/K8S%E7%9A%84GPU%E8%B0%83%E5%BA%A6/">K8S的GPU调度</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="K8S的GPU调度"><a href="#K8S的GPU调度" class="headerlink" title="K8S的GPU调度"></a>K8S的GPU调度</h1><p>环境要求: Kubernetes v1.26 [stable]</p>
<p>Kubernetes可以通过设备插件来稳定的管理你的集群不同节点之间的AMD和Nvidia的图像处理单元。</p>
<p>本章会展示用户如何使用GPU并且概述了其中的一些限制。</p>
<h2 id="使用设备插件"><a href="#使用设备插件" class="headerlink" title="使用设备插件"></a>使用设备插件</h2><p>Kubernetes 实现了设备插件，允许 Pods(Pods是K8S中可以创建和管理的最小的可部署计算单元)访问专门的硬件特性，如 GPUs。</p>
<p>首先作为管理员，你应该先给GPU装上相关公司提供的驱动程序和运行相应的设备插件程序，下面有几个主流公司的设备插件程序地址:</p>
<p>AMD: </p>
<p><a target="_blank" rel="noopener" href="https://intel.github.io/intel-device-plugins-for-kubernetes/cmd/gpu_plugin/README.html">Intel GPU device plugin for Kubernetes — Intel® Device Plugins for Kubernetes  documentation</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/RadeonOpenCompute/k8s-device-plugin#deployment">GitHub - RadeonOpenCompute&#x2F;k8s-device-plugin: Kubernetes (k8s) device plugin to enable registration of AMD GPU to a container cluster</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/NVIDIA/k8s-device-plugin#quick-start">GitHub - NVIDIA&#x2F;k8s-device-plugin: NVIDIA device plugin for Kubernetes</a></p>
<p>如果你安装了相应的插件，你的集群会暴露出一个可定制的调度资源比如<code>amd.com/gpu</code> 和</p>
<p><code>[nvidia.com/gpu](http://nvidia.com/gpu)</code> 。</p>
<p>通过自定义的GPU资源，你可以从容器中使用这些GPU，就像你请求CPU和内存资源的方式一样。</p>
<p>然后在如何自定义设备的制定需求的时候有一些限制。</p>
<p>GPU只能在限制下被指定，这意味着：</p>
<ul>
<li>你可以在不指定请求的情况下指定GPU的限制。因为默认情况下k8s会将这个限制作为对请求的默认限制。</li>
<li>你可以指定对请求的限制的同时也可以设置对GPU的限制，但是这两个值必须相等。</li>
<li>你不能再没有指定GPU限制的情况下也不设置请求的限制。</li>
</ul>
<p>下面是一个有关Pod请求GPU的清单示例:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">example-vector-add</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">OnFailure</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">example-vector-add</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">&quot;registry.example/example-vector-add:v42&quot;</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">limits:</span></span><br><span class="line">          <span class="attr">gpu-vendor.example/example-gpu:</span> <span class="number">1</span> <span class="comment"># requesting 1 GPU</span></span><br></pre></td></tr></table></figure>

<h2 id="包含不同类型-GPU-的集群"><a href="#包含不同类型-GPU-的集群" class="headerlink" title="包含不同类型 GPU 的集群"></a>包含不同类型 GPU 的集群</h2><p>如果集群中的不同节点具有不同类型的 GPU，那么可以使用节点标签和节点选择器将 pods 调度到适当的节点。</p>
<p>比如:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Label your nodes with the accelerator type they have.</span></span><br><span class="line">kubectl label nodes node1 accelerator=example-gpu-x100</span><br><span class="line">kubectl label nodes node2 accelerator=other-gpu-k915</span><br></pre></td></tr></table></figure>

<p>标签键的accelerator只是一个例子; 如果愿意，可以使用不同的标签键。</p>
<h2 id="自动节点标记"><a href="#自动节点标记" class="headerlink" title="自动节点标记"></a>自动节点标记</h2><p>如果你使用的是 AMD GPU 设备，则可以部署节点标签器。节点标签器是一个控制器，自动标记你的节点中的GPU 设备属性。</p>
<hr>
<p>NVIDIA 的类似功能由 <a target="_blank" rel="noopener" href="https://github.com/NVIDIA/gpu-feature-discovery/blob/main/README.md">GPU feature discovery</a>提供。</p>
<p>reference: <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/tasks/manage-gpus/scheduling-gpus/">https://kubernetes.io/docs/tasks/manage-gpus/scheduling-gpus/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wangxso.github.io/blog./2023/07/12/K8S%E7%9A%84GPU%E8%B0%83%E5%BA%A6/" data-id="clmivdq7y000dsjp62og38u3v" data-title="K8S的GPU调度" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-关于Carla两三点事" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog./2023/07/11/%E5%85%B3%E4%BA%8ECarla%E4%B8%A4%E4%B8%89%E7%82%B9%E4%BA%8B/" class="article-date">
  <time class="dt-published" datetime="2023-07-11T06:48:00.000Z" itemprop="datePublished">2023-07-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog./categories/selfdriving/">selfdriving</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog./2023/07/11/%E5%85%B3%E4%BA%8ECarla%E4%B8%A4%E4%B8%89%E7%82%B9%E4%BA%8B/">关于Carla两三点事</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Carla"><a href="#Carla" class="headerlink" title="Carla"></a>Carla</h1><h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1. 介绍"></a>1. 介绍</h2><p>CARLA 是开源的自动驾驶仿真器。他是从零开始构建的，通过模块化和灵活的API来解决一系列与自动驾驶相关的任务。CARLA基于虚幻引擎构建仿真环境，使用OpenDRIVE规范来定义道路和城市环境。对于仿真的控制是通过Python或C++调用API来控制的，随着项目的开发这样的API会越来越多。</p>
<h3 id="仿真器"><a href="#仿真器" class="headerlink" title="仿真器"></a>仿真器</h3><p>CARLA由一个可伸缩的主从架构组成。</p>
<p>服务端负责所有与模型相关的东西，包括传感器渲染，物理学的计算，世界状态和行为的更新等。</p>
<h3 id="存在的问题"><a href="#存在的问题" class="headerlink" title="存在的问题"></a>存在的问题</h3><ol>
<li><p>Ubuntu 22.04 由于clang11的原因无法安装Carla。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/carla-simulator/carla/issues/6381%E8%AF%A5issue%E6%8F%90%E5%88%B0%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E6%97%A0%E6%95%88%EF%BC%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%97%A0%E6%B3%95%E8%BF%90%E8%A1%8C%E3%80%82">https://github.com/carla-simulator/carla/issues/6381该issue提到的解决方法无效，客户端无法运行。</a></p>
</li>
<li><p>Carla很大注意预留好硬盘空间，大概需要100G左右</p>
</li>
<li><p>cannot find -lstdc++<br>今天重新搞carla的时候遇到了这个问题。先说如何解决:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang++ --verbose</span><br></pre></td></tr></table></figure>
<p>可以看到如下的输出:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">clang version 10.0.0-4ubuntu1 </span><br><span class="line">Target: x86_64-pc-linux-gnu</span><br><span class="line">Thread model: posix</span><br><span class="line">InstalledDir: /usr/bin</span><br><span class="line">Found candidate GCC installation: /usr/bin/../lib/gcc/x86_64-linux-gnu/10</span><br><span class="line">......</span><br><span class="line">Selected GCC installation:  /usr/bin/../lib/gcc/x86_64-linux-gnu/13</span><br><span class="line">Candidate multilib: .;@m64</span><br><span class="line">Selected multilib: .;@m64</span><br></pre></td></tr></table></figure>
<p><strong>Select GCC XXXXXXXXX u&#x2F;13</strong></p>
</li>
</ol>
<p>看到这个数字13了把，你就安装对应版本的libstdc++，如下所示</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libstdc++-13-dev</span><br></pre></td></tr></table></figure>

<hr>
<p>分割线，等我想更新了再写</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wangxso.github.io/blog./2023/07/11/%E5%85%B3%E4%BA%8ECarla%E4%B8%A4%E4%B8%89%E7%82%B9%E4%BA%8B/" data-id="clmivdq8s004vsjp62r6b5z05" data-title="关于Carla两三点事" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ROS2装尝试" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog./2023/07/07/ROS2%E8%A3%85%E5%B0%9D%E8%AF%95/" class="article-date">
  <time class="dt-published" datetime="2023-07-07T00:07:00.000Z" itemprop="datePublished">2023-07-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog./categories/selfdriving/">selfdriving</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog./2023/07/07/ROS2%E8%A3%85%E5%B0%9D%E8%AF%95/">ROS2装尝试</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="ROS2"><a href="#ROS2" class="headerlink" title="ROS2"></a>ROS2</h1><ol>
<li><p><del>关闭SIP</del></p>
<ol>
<li><del>关机</del></li>
<li><del>按住开机键10秒，知道出现选择启动项界面，选择设置</del></li>
<li><del>选择终端</del></li>
</ol>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">csrutil <span class="built_in">disable</span></span><br></pre></td></tr></table></figure>
<p> <del>然后重启电脑即可。</del>
 </p>
</li>
<li><p><del>M1的Macbook Air下的MacOS 13.4.1 Venture版本出现错误, 执行</del> </p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">colcon build --symlink-install --packages-skip-by-dep python_qt_binding</span><br></pre></td></tr></table></figure>
<p>   <del>发生了错误</del></p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">--- stderr: rviz_ogre_vendor</span><br><span class="line">In file included from /Users/wangxs/ros2_iron/build/rviz_ogre_vendor/ogre-v1.12.10-prefix/src/ogre-v1.12.10/OgreMain/src/OgreASTCCodec.cpp:29:</span><br><span class="line">In file included from /Users/wangxs/ros2_iron/build/rviz_ogre_vendor/ogre-v1.12.10-prefix/src/ogre-v1.12.10/OgreMain/src/OgreStableHeaders.h:45:</span><br><span class="line">In file included from /Users/wangxs/ros2_iron/build/rviz_ogre_vendor/ogre-v1.12.10-prefix/src/ogre-v1.12.10/OgreMain/include/OgrePrerequisites.h:35:</span><br><span class="line">/Users/wangxs/ros2_iron/build/rviz_ogre_vendor/ogre-v1.12.10-prefix/src/ogre-v1.12.10/OgreMain/include/OgrePlatform.h:183:13: fatal error: <span class="string">&#x27;Availability.h&#x27;</span> file not found</span><br><span class="line"><span class="comment">#   include &quot;Availability.h&quot;</span></span><br><span class="line">            ^~~~~~~~~~~~~~~~</span><br><span class="line">1 error generated.</span><br></pre></td></tr></table></figure>

<p><del>我在网上搜了原因和解决方法都无果，比如</del></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ros2/ros2/issues/948">https://github.com/ros2/ros2/issues/948</a></p>
<p><del>我的猜想可能跟xcode版本有关，旧版本的xcode可能会带有该头文件，并且可能我的版本太新了导致的，随即不折腾了</del>。</p>
<ol>
<li>Docker启动(曲线救国)<ol>
<li><p>拉取Ubuntu22.04镜像</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull ubuntu:22.04</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行容器 </p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --name ubuntu-test -v /yourpath:/mnt ubuntu:22.04 </span><br></pre></td></tr></table></figure>
</li>
<li><p>运行命令进入容器</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it ubuntu-test /bin/bash</span><br></pre></td></tr></table></figure>
</li>
<li><p>根据ros2文档进行安装</p>
<p> <a target="_blank" rel="noopener" href="https://docs.ros.org/en/iron/Installation/Alternatives/Ubuntu-Development-Setup.html#">ROS2 Installation For Ubuntu</a></p>
</li>
</ol>
</li>
</ol>
<p>遇到了坑点，因为docker没有图形界面，所以导致turtlesim的样例无法启动。解决办法还是有的就是想我之前安装<strong>mininet</strong>一样。</p>
<p><a target="_blank" rel="noopener" href="https://blog.wangx.wang/index.php/archives/181/">如何让mininet在M1系列的Macbook上运行？ - Wangxs的博客</a></p>
<p>但是我这是虚拟机的解决方案？不会让我装在虚拟机里吧，emm。算了暂时不搞哪个样例了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wangxso.github.io/blog./2023/07/07/ROS2%E8%A3%85%E5%B0%9D%E8%AF%95/" data-id="clmivdq83000wsjp6ab782k6y" data-title="ROS2装尝试" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Adobe Creative Cloud打开显示您没有管理应用程序的权限解决方案" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog./2023/03/05/Adobe%20Creative%20Cloud%E6%89%93%E5%BC%80%E6%98%BE%E7%A4%BA%E6%82%A8%E6%B2%A1%E6%9C%89%E7%AE%A1%E7%90%86%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%9D%83%E9%99%90%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="article-date">
  <time class="dt-published" datetime="2023-03-05T04:57:00.000Z" itemprop="datePublished">2023-03-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog./categories/zczb/">zczb</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog./2023/03/05/Adobe%20Creative%20Cloud%E6%89%93%E5%BC%80%E6%98%BE%E7%A4%BA%E6%82%A8%E6%B2%A1%E6%9C%89%E7%AE%A1%E7%90%86%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%9D%83%E9%99%90%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">Adobe Creative Cloud打开显示您没有管理应用程序的权限解决方案</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><strong>今天安装了Adobe Creative Cloud突然发现和前次在Mac上安装出现了一样的错误。所以就自己写个怎么解决的方案吧。</strong></p>
<p>原网站: <a target="_blank" rel="noopener" href="https://www.mac69.com/news/2123.html">https://www.mac69.com/news/2123.html</a></p>
<p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/03/4228446856.png"></p>
<h2 id="MacOS"><a href="#MacOS" class="headerlink" title="MacOS"></a>MacOS</h2><ul>
<li><p>点击访达【前往】【前往文件夹】，或者使用<br><code>shift+command+g</code>快捷键，如图：<br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/03/2917999684.png"></p>
</li>
<li><p>前往<code>/Library/Application Support/Adobe/OOBE/Configs/</code>路径，如图：<br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/03/2807200452.png"></p>
</li>
<li><p>找到<code>ServiceConfig.xml</code>文件，复制<code>ServiceConfig.xml</code>文件到桌面，使用文本编辑打开，如图：<br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/03/3609786159.png"></p>
</li>
<li><p>此时第一行<code>visiable</code>内容显示为<code>false</code>，如图：<br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/03/3435026113.png"></p>
</li>
<li><p>将<code>false</code>更改为<code>true</code>然后保存，如图：<br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/03/1880148662.png"><br>之后重新登录creative cloud账号即可正常使用！</p>
</li>
</ul>
<h1 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h1><ul>
<li>打开资源管理器，在上方地址栏输入<code>C:\Program Files (x86)\Common Files\Adobe\OOBE\Configs</code></li>
</ul>
<p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/03/3715890375.png"></p>
<ul>
<li>选择用记事本打开<code>ServiceConfig.xml</code>,此时visible的值为<code>false</code><br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/03/3696892130.png"></li>
<li>将它改为<code>true</code>保存<br><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/03/1091517381.png"></li>
</ul>
<p>之后重新登录creative cloud账号即可正常使用！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wangxso.github.io/blog./2023/03/05/Adobe%20Creative%20Cloud%E6%89%93%E5%BC%80%E6%98%BE%E7%A4%BA%E6%82%A8%E6%B2%A1%E6%9C%89%E7%AE%A1%E7%90%86%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%9D%83%E9%99%90%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" data-id="clmivdq7t0003sjp68viha7dv" data-title="Adobe Creative Cloud打开显示您没有管理应用程序的权限解决方案" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-NasTool企业微信回调设置(新)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog./2023/01/16/NasTool%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E5%9B%9E%E8%B0%83%E8%AE%BE%E7%BD%AE(%E6%96%B0)/" class="article-date">
  <time class="dt-published" datetime="2023-01-15T20:22:00.000Z" itemprop="datePublished">2023-01-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog./categories/zczb/">zczb</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/blog./2023/01/16/NasTool%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E5%9B%9E%E8%B0%83%E8%AE%BE%E7%BD%AE(%E6%96%B0)/">NasTool企业微信回调设置(新)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="1-创建企业微信应用"><a href="#1-创建企业微信应用" class="headerlink" title="1 创建企业微信应用"></a>1 创建企业微信应用</h1><ul>
<li>step1 进入链接<a target="_blank" rel="noopener" href="https://work.weixin.qq.com/wework_admin/frame#apps">https://work.weixin.qq.com/wework_admin/frame#apps</a></li>
</ul>
<p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/01/4227550833.png"></p>
<ul>
<li>step 2 输入相关信息</li>
</ul>
<p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/01/3631833767.png"></p>
<ul>
<li>step3 记住AgentId和Secret</li>
</ul>
<p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/01/2799206703.png"></p>
<ul>
<li>step4 获取企业ID</li>
</ul>
<p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/01/2584071887.png"></p>
<p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/01/31056227.png"></p>
<ul>
<li>step5 回到nastool填写信息</li>
</ul>
<p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/01/3376161872.png"></p>
<blockquote>
<p>填写企业ID、Secret和应用ID，消息推送代理下面在填写</p>
</blockquote>
<h1 id="2-消息推送-回调设置"><a href="#2-消息推送-回调设置" class="headerlink" title="2. 消息推送&amp;回调设置"></a>2. 消息推送&amp;回调设置</h1><ul>
<li>点击进入</li>
</ul>
<p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/01/1655452374.png"></p>
<ul>
<li>点击设置API</li>
</ul>
<p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/01/525685936.png"></p>
<ul>
<li>设置API，这里先别保存，先把相关信息填到nastool里面点击保存后再点企业微信这边的保存，不然不通过的。<strong>注意第一个地址是你本机nastool所在的地址，并且你要有公网IP进行ddns或者你用反向代理FRP之类的也行。</strong></li>
</ul>
<p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/01/2932680131.png"></p>
<ul>
<li><p>最后对于<strong>消息推送代理</strong>的设置，由于企业微信更新了规则，所以以前作者提供的代理服务器不行了，所以要自行搭建一下。</p>
<ul>
<li><p>找一台有公网IP的服务器，如云服务商的服务器，我用的是阿里云的。</p>
</li>
<li><p>如果你用的Nginx，那么就在你所对应网站的Nginx配置文件中加入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location /cgi-bin/gettoken &#123;</span><br><span class="line">  proxy_pass https://qyapi.weixin.qq.com;</span><br><span class="line">&#125;</span><br><span class="line">location /cgi-bin/message/send &#123;</span><br><span class="line">  proxy_pass https://qyapi.weixin.qq.com; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果你用的是Caddy搭建代理服务(（<code>&#123;upstream_hostport&#125;</code> 部分不是变量，不要改，原封不动复制粘贴过去即可）)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reverse_proxy https://qyapi.weixin.qq.com &#123;</span><br><span class="line">  header_up Host &#123;upstream_hostport&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后在你的nastool配置中的消息推送代理，填入你Nginx的地址如 <a target="_blank" rel="noopener" href="http://nastool.example.com/">http://nastool.example.com</a> 即可</p>
</li>
</ul>
</li>
</ul>
<h1 id="3-配置微信菜单控制"><a href="#3-配置微信菜单控制" class="headerlink" title="3. 配置微信菜单控制"></a>3. 配置微信菜单控制</h1><ul>
<li>配置微信菜单控制 通过菜单远程控制工具运行，在<a target="_blank" rel="noopener" href="https://work.weixin.qq.com/wework_admin/frame#apps">https://work.weixin.qq.com/wework_admin/frame#apps</a> 应用自定义菜单页面按如下图所示维护好菜单，菜单内容为发送消息，消息内容随意。<strong>一级菜单及一级菜单下的前几个子菜单顺序需要一模一样</strong>，在符合截图的示例项后可以自己增加别的二级菜单项。</li>
</ul>
<p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/01/2959344127.png"></p>
<p><img src="https://wangxblog.oss-cn-hangzhou.aliyuncs.com/usr/uploads/2023/01/3174108928.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://wangxso.github.io/blog./2023/01/16/NasTool%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E5%9B%9E%E8%B0%83%E8%AE%BE%E7%BD%AE(%E6%96%B0)/" data-id="clmivdq81000lsjp611rvaw7o" data-title="NasTool企业微信回调设置(新)" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/blog./page/2/">2</a><a class="page-number" href="/blog./page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/blog./page/8/">8</a><a class="extend next" rel="next" href="/blog./page/2/">weiter &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog./categories/JUC/">JUC</a></li><li class="category-list-item"><a class="category-list-link" href="/blog./categories/JVM/">JVM</a></li><li class="category-list-item"><a class="category-list-link" href="/blog./categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/blog./categories/LeetCode/">LeetCode</a></li><li class="category-list-item"><a class="category-list-link" href="/blog./categories/SQL/">SQL</a></li><li class="category-list-item"><a class="category-list-link" href="/blog./categories/bxjs/">bxjs</a></li><li class="category-list-item"><a class="category-list-link" href="/blog./categories/cuda/">cuda</a></li><li class="category-list-item"><a class="category-list-link" href="/blog./categories/default/">default</a></li><li class="category-list-item"><a class="category-list-link" href="/blog./categories/dsbj/">dsbj</a></li><li class="category-list-item"><a class="category-list-link" href="/blog./categories/jvmbook/">jvmbook</a></li><li class="category-list-item"><a class="category-list-link" href="/blog./categories/muban/">muban</a></li><li class="category-list-item"><a class="category-list-link" href="/blog./categories/selfdriving/">selfdriving</a></li><li class="category-list-item"><a class="category-list-link" href="/blog./categories/youji/">youji</a></li><li class="category-list-item"><a class="category-list-link" href="/blog./categories/zczb/">zczb</a></li><li class="category-list-item"><a class="category-list-link" href="/blog./categories/%E7%AE%97%E6%B3%95/">算法</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/blog./tags/OpenCDA/" rel="tag">OpenCDA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog./tags/V2X/" rel="tag">V2X</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog./tags/%E6%91%84%E5%BD%B1/" rel="tag">摄影</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/blog./tags/OpenCDA/" style="font-size: 10px;">OpenCDA</a> <a href="/blog./tags/V2X/" style="font-size: 10px;">V2X</a> <a href="/blog./tags/%E6%91%84%E5%BD%B1/" style="font-size: 10px;">摄影</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2023/09/">September 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog./archives/2019/10/">October 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog./2023/09/14/OpenCDA%20V2X%E9%80%9A%E4%BF%A1%E7%9B%B8%E5%85%B3/">OpenCDA V2X通信相关</a>
          </li>
        
          <li>
            <a href="/blog./2023/08/28/%E5%8F%A4%E6%9C%B4%E9%9F%B5%E5%91%B3%E4%B8%8E%E8%8D%92%E9%87%8E%E4%B9%8B%E7%BE%8E%20-------%20%E8%A5%BF%E5%AE%89%E3%80%81%E9%9D%92%E6%B5%B7%E4%B9%8B%E6%97%85/">古朴韵味与荒野之美 ------- 西安、青海之旅</a>
          </li>
        
          <li>
            <a href="/blog./2023/08/03/%E3%80%90OpenCDA%E3%80%91%E7%AE%97%E6%B3%95%E5%AE%9A%E5%88%B6%E5%8C%96%E5%BC%80%E5%8F%91/">【OpenCDA】算法定制化开发</a>
          </li>
        
          <li>
            <a href="/blog./2023/08/01/zlib%20404/">zlib 404</a>
          </li>
        
          <li>
            <a href="/blog./2023/07/19/V2X%E5%9C%BA%E6%99%AF%E5%8F%91%E5%B1%95%E5%92%8C%E4%BB%BF%E7%9C%9F/">V2X场景发展和仿真</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 wangxso<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/blog./" class="mobile-nav-link">Home</a>
  
    <a href="/blog./archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/blog./js/jquery-3.6.4.min.js"></script>



  
<script src="/blog./fancybox/jquery.fancybox.min.js"></script>




<script src="/blog./js/script.js"></script>





  </div>
</body>
</html>